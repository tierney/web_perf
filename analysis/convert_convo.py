#!/usr/bin/env python

convo = '''25	74	5.178600000	192.168.42.196	38829	74.125.65.93	80	1	0
32	66	5.533309000	74.125.65.93	80	192.168.42.196	38829	1	1
33	54	5.533374000	192.168.42.196	38829	74.125.65.93	80	0	1
34	351	5.533580000	192.168.42.196	38829	74.125.65.93	80	0	1	http://www.youtube.com/
37	54	5.874572000	74.125.65.93	80	192.168.42.196	38829	0	1
39	54	6.623299000	74.125.65.93	80	192.168.42.196	38829	0	1
40	1314	8.002547000	74.125.65.93	80	192.168.42.196	38829	0	1
41	54	8.002588000	192.168.42.196	38829	74.125.65.93	80	0	1
42	1314	8.011734000	74.125.65.93	80	192.168.42.196	38829	0	1
43	54	8.011783000	192.168.42.196	38829	74.125.65.93	80	0	1
44	782	8.011849000	74.125.65.93	80	192.168.42.196	38829	0	1
45	54	8.011865000	192.168.42.196	38829	74.125.65.93	80	0	1
46	1185	8.011877000	74.125.65.93	80	192.168.42.196	38829	0	1
47	54	8.011889000	192.168.42.196	38829	74.125.65.93	80	0	1
48	1166	8.011899000	74.125.65.93	80	192.168.42.196	38829	0	1
49	54	8.011908000	192.168.42.196	38829	74.125.65.93	80	0	1
50	863	8.020482000	74.125.65.93	80	192.168.42.196	38829	0	1
51	54	8.020502000	192.168.42.196	38829	74.125.65.93	80	0	1
52	799	8.020510000	74.125.65.93	80	192.168.42.196	38829	0	1
53	54	8.020512000	192.168.42.196	38829	74.125.65.93	80	0	1
54	682	8.020515000	74.125.65.93	80	192.168.42.196	38829	0	1
55	54	8.020517000	192.168.42.196	38829	74.125.65.93	80	0	1
56	911	8.020519000	74.125.65.93	80	192.168.42.196	38829	0	1
57	54	8.020521000	192.168.42.196	38829	74.125.65.93	80	0	1
59	691	8.031074000	74.125.65.93	80	192.168.42.196	38829	0	1
60	756	8.031098000	74.125.65.93	80	192.168.42.196	38829	0	1
61	54	8.031102000	192.168.42.196	38829	74.125.65.93	80	0	1
62	54	8.031111000	192.168.42.196	38829	74.125.65.93	80	0	1
63	782	8.031212000	74.125.65.93	80	192.168.42.196	38829	0	1
64	54	8.031220000	192.168.42.196	38829	74.125.65.93	80	0	1
65	806	8.031225000	74.125.65.93	80	192.168.42.196	38829	0	1
66	54	8.031229000	192.168.42.196	38829	74.125.65.93	80	0	1
67	721	8.031232000	74.125.65.93	80	192.168.42.196	38829	0	1
68	54	8.031235000	192.168.42.196	38829	74.125.65.93	80	0	1
69	787	8.039857000	74.125.65.93	80	192.168.42.196	38829	0	1
70	54	8.039887000	192.168.42.196	38829	74.125.65.93	80	0	1
71	1314	8.049991000	74.125.65.93	80	192.168.42.196	38829	0	1
72	54	8.050007000	192.168.42.196	38829	74.125.65.93	80	0	1
73	598	8.050028000	74.125.65.93	80	192.168.42.196	38829	0	1
74	54	8.050041000	192.168.42.196	38829	74.125.65.93	80	0	1
75	1314	8.122910000	74.125.65.93	80	192.168.42.196	38829	0	1
76	54	8.122952000	192.168.42.196	38829	74.125.65.93	80	0	1
77	1314	8.122972000	74.125.65.93	80	192.168.42.196	38829	0	1
78	54	8.122979000	192.168.42.196	38829	74.125.65.93	80	0	1
79	1204	8.130233000	74.125.65.93	80	192.168.42.196	38829	0	1		200
80	54	8.130265000	192.168.42.196	38829	74.125.65.93	80	0	1
908	54	13.707514000	192.168.42.196	38829	74.125.65.93	80	0	1'''

class TcpLine(object):
  def __init__(self, frame_num, size, timestamp, src_ip, src_port, dst_ip,
               dst_port, syn, ack, req_uri = None, resp_code = None):
    self.frame_num = frame_num
    self.size = size
    self.timestamp = timestamp
    self.src_ip = src_ip
    self.src_port = src_port
    self.dst_ip = dst_ip
    self.dst_port = dst_port
    self.syn = bool(int(syn))
    self.ack = bool(int(ack))
    self.req_uri = req_uri
    self.resp_code = resp_code

SYN_ACK = False
REQ_ACK = False

convo_name = ''
for line in convo.split('\n'):
  split_line = line.split('\t')
  tcp_line = TcpLine(*split_line)

  # SYN
  if tcp_line.syn and not tcp_line.ack:
    source_ip = tcp_line.src_ip
    convo_name = '%s:%s<->%s%s' % (tcp_line.src_ip, tcp_line.src_port,
                                   tcp_line.dst_ip, tcp_line.dst_port)
    SYN_ACK = True
    print convo_name, tcp_line.timestamp,
    continue
  # SYNACK
  if SYN_ACK:
    print tcp_line.timestamp, 'SYNACK'
    SYN_ACK = False
    continue

  # REQUEST
  if tcp_line.req_uri:
    REQ_ACK = True
    print convo_name, tcp_line.timestamp,
    continue
  if REQ_ACK:
    print tcp_line.timestamp, 'GET'
    REQ_ACK = False
    continue

  if tcp_line.resp_code:
    print convo_name, tcp_line.timestamp, tcp_line.timestamp, 'RESP'
    continue

  if tcp_line.src_ip == source_ip:
    comment = 'ACK'
  else:
    comment = 'RESP'
  print convo_name, tcp_line.timestamp, tcp_line.timestamp, comment

  # frame_num, size, timestamp, src_ip, src_port, dst_ip, dst_port, syn, ack = line.split('\t')
